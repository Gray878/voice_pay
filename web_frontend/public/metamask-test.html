<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetaMask è¯Šæ–­å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #0F172A;
            color: #F8FAFC;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 2px solid;
        }
        .success {
            background: rgba(16, 185, 129, 0.1);
            border-color: #10b981;
        }
        .error {
            background: rgba(239, 68, 68, 0.1);
            border-color: #ef4444;
        }
        .warning {
            background: rgba(245, 158, 11, 0.1);
            border-color: #F59E0B;
        }
        button {
            background: linear-gradient(135deg, #F59E0B 0%, #FBBF24 100%);
            color: #0F172A;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(245, 158, 11, 0.6);
        }
        pre {
            background: rgba(30, 41, 59, 0.8);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
        }
        h1 {
            color: #FBBF24;
        }
        h2 {
            color: #F59E0B;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <h1>ğŸ” MetaMask è¯Šæ–­å·¥å…·</h1>
    
    <div id="status"></div>
    
    <h2>æ“ä½œ</h2>
    <button onclick="checkMetaMask()">æ£€æŸ¥ MetaMask</button>
    <button onclick="connectWallet()">è¿æ¥é’±åŒ…</button>
    <button onclick="getAccounts()">è·å–è´¦æˆ·</button>
    <button onclick="getChainId()">è·å–é“¾ ID</button>
    <button onclick="location.reload()">åˆ·æ–°é¡µé¢</button>
    
    <h2>è¯¦ç»†ä¿¡æ¯</h2>
    <div id="details"></div>

    <script>
        function log(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'warning';
            statusDiv.innerHTML += `<div class="status ${className}">${message}</div>`;
            console.log(message);
        }

        function showDetails(title, data) {
            const detailsDiv = document.getElementById('details');
            detailsDiv.innerHTML += `<h3>${title}</h3><pre>${JSON.stringify(data, null, 2)}</pre>`;
        }

        async function checkMetaMask() {
            document.getElementById('status').innerHTML = '';
            document.getElementById('details').innerHTML = '';
            
            log('ğŸ” å¼€å§‹æ£€æŸ¥ MetaMask...', 'info');
            
            // æ£€æŸ¥ window.ethereum
            if (typeof window.ethereum === 'undefined') {
                log('âŒ window.ethereum æœªå®šä¹‰', 'error');
                log('MetaMask æœªå®‰è£…æˆ–æœªåŠ è½½', 'error');
                log('è¯·ç¡®ä¿:\n1. å·²å®‰è£… MetaMask æ‰©å±•\n2. æ‰©å±•å·²å¯ç”¨\n3. åˆ·æ–°é¡µé¢', 'warning');
                return;
            }
            
            log('âœ… window.ethereum å·²æ‰¾åˆ°', 'success');
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯ MetaMask
            if (window.ethereum.isMetaMask) {
                log('âœ… ç¡®è®¤æ˜¯ MetaMask', 'success');
            } else {
                log('âš ï¸ ä¸æ˜¯ MetaMask æˆ–ç‰ˆæœ¬è¾ƒæ—§', 'warning');
            }
            
            // æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
            const info = {
                isMetaMask: window.ethereum.isMetaMask,
                chainId: window.ethereum.chainId,
                networkVersion: window.ethereum.networkVersion,
                selectedAddress: window.ethereum.selectedAddress,
            };
            
            showDetails('window.ethereum ä¿¡æ¯', info);
            
            log('âœ… MetaMask æ£€æŸ¥å®Œæˆ', 'success');
        }

        async function connectWallet() {
            document.getElementById('status').innerHTML = '';
            
            log('ğŸ”— å¼€å§‹è¿æ¥é’±åŒ…...', 'info');
            
            if (typeof window.ethereum === 'undefined') {
                log('âŒ MetaMask æœªæ‰¾åˆ°', 'error');
                return;
            }
            
            try {
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });
                
                log(`âœ… è¿æ¥æˆåŠŸï¼`, 'success');
                log(`è´¦æˆ·: ${accounts[0]}`, 'success');
                
                showDetails('è¿æ¥çš„è´¦æˆ·', accounts);
            } catch (error) {
                log(`âŒ è¿æ¥å¤±è´¥: ${error.message}`, 'error');
                log(`é”™è¯¯ä»£ç : ${error.code}`, 'error');
                showDetails('é”™è¯¯è¯¦æƒ…', error);
            }
        }

        async function getAccounts() {
            document.getElementById('status').innerHTML = '';
            
            if (typeof window.ethereum === 'undefined') {
                log('âŒ MetaMask æœªæ‰¾åˆ°', 'error');
                return;
            }
            
            try {
                const accounts = await window.ethereum.request({
                    method: 'eth_accounts'
                });
                
                if (accounts.length > 0) {
                    log(`âœ… æ‰¾åˆ° ${accounts.length} ä¸ªè´¦æˆ·`, 'success');
                    showDetails('è´¦æˆ·åˆ—è¡¨', accounts);
                } else {
                    log('âš ï¸ æœªæ‰¾åˆ°å·²è¿æ¥çš„è´¦æˆ·', 'warning');
                    log('è¯·å…ˆç‚¹å‡»"è¿æ¥é’±åŒ…"æŒ‰é’®', 'warning');
                }
            } catch (error) {
                log(`âŒ è·å–è´¦æˆ·å¤±è´¥: ${error.message}`, 'error');
                showDetails('é”™è¯¯è¯¦æƒ…', error);
            }
        }

        async function getChainId() {
            document.getElementById('status').innerHTML = '';
            
            if (typeof window.ethereum === 'undefined') {
                log('âŒ MetaMask æœªæ‰¾åˆ°', 'error');
                return;
            }
            
            try {
                const chainId = await window.ethereum.request({
                    method: 'eth_chainId'
                });
                
                const chainIdDec = parseInt(chainId, 16);
                const chainNames = {
                    1: 'Ethereum Mainnet',
                    5: 'Goerli Testnet',
                    137: 'Polygon Mainnet',
                    80001: 'Polygon Mumbai Testnet',
                    11155111: 'Sepolia Testnet'
                };
                
                const chainName = chainNames[chainIdDec] || 'æœªçŸ¥ç½‘ç»œ';
                
                log(`âœ… å½“å‰é“¾ ID: ${chainId} (${chainIdDec})`, 'success');
                log(`ç½‘ç»œ: ${chainName}`, 'success');
                
                showDetails('é“¾ä¿¡æ¯', {
                    chainIdHex: chainId,
                    chainIdDecimal: chainIdDec,
                    networkName: chainName
                });
            } catch (error) {
                log(`âŒ è·å–é“¾ ID å¤±è´¥: ${error.message}`, 'error');
                showDetails('é”™è¯¯è¯¦æƒ…', error);
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('ğŸ“„ é¡µé¢å·²åŠ è½½ï¼Œå¼€å§‹è‡ªåŠ¨æ£€æŸ¥...', 'info');
                checkMetaMask();
            }, 1000);
        });

        // ç›‘å¬ MetaMask äº‹ä»¶
        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.on('accountsChanged', (accounts) => {
                log(`ğŸ”„ è´¦æˆ·å·²å˜åŒ–: ${accounts[0] || 'æ— '}`, 'warning');
            });

            window.ethereum.on('chainChanged', (chainId) => {
                log(`ğŸ”„ é“¾å·²åˆ‡æ¢: ${chainId}`, 'warning');
                setTimeout(() => location.reload(), 1000);
            });
        }
    </script>
</body>
</html>
